import pandas as pd
import json
import os
import sys

# Add project root to path to find data
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
PROCESSED_DATA_PATH = os.path.join(BASE_DIR, "data", "processed", "cicddos2019_processed.csv")

# The attack data string you provided (last value '1' is the label)
data_str = "0.5301273064850545,-0.445433562417894,-0.4122819815042434,-0.4992237321780884,-0.12157008159287032,-0.02633133602454141,-0.2811207052980731,0.14381998248128827,-0.2781686116554371,-0.1707190000355294,-0.3092973951655942,-0.25663879779999516,1.6259526868095155,-0.3311962955336943,1.7938503647126791,1.672118696606984,-0.03330026031690797,-0.12359567608926256,-0.5539630860679697,-0.530441658072312,-0.48637820101814333,-0.03694325985114522,-0.47118833047358216,-0.385698071965026,-0.4486994308875534,-0.4544242174139369,-0.0545601357979758,-0.2756839739299617,-0.16999183457976436,-0.24107156074785732,-0.25121966039038496,-0.056128387264938455,-0.18537982174378762,0.0,0.0,0.0,-0.1051739448773461,-0.028901267624782425,-0.11393564501455193,-0.08211612318125851,-0.5119767942581611,1.451271994842521,1.6784549293508357,1.5976731150412076,1.6780435244823797,-0.051752847981586046,-0.18537982174378762,-0.010937111345450891,1.3592793798295126,-1.0089484753342999,-0.4047361732972544,0.0,-0.010937111345450891,-0.004077562928560374,1.7352315172065167,-0.3092973951655942,1.7938503647126645,-0.1051739448773461,0.0,0.0,0.0,0.0,0.0,0.0,-0.12157008159287032,-0.2811207052980731,-0.02633133602454141,0.14381998248128827,0.49074580496509157,-0.0861057517832292,-0.10689049916085888,-0.35582759552484794,-0.23163607825468924,-0.06151270021961551,-0.23114772763937513,-0.22648367468252595,-0.4723500132685222,-0.2831398965171196,-0.47836898901161595,-0.391075313978903,1"

def generate_json():
    if not os.path.exists(PROCESSED_DATA_PATH):
        print(f"Error: {PROCESSED_DATA_PATH} not found. Run preprocessing first.")
        return

    # Load just the header to get feature names
    df = pd.read_csv(PROCESSED_DATA_PATH, nrows=0)
    feature_names = [col.strip() for col in df.columns if col.strip() != "Label"]

    # Parse the data string
    values = [float(x) for x in data_str.split(",")]

    # Remove the label (last item) if values include it
    if len(values) == len(feature_names) + 1:
        values = values[:-1]

    if len(values) != len(feature_names):
        print(f"Error: Mismatch in feature count. Expected {len(feature_names)}, got {len(values)}")
        return

    # Create dictionary
    payload = dict(zip(feature_names, values))
    
    # Print JSON
    print(json.dumps(payload, indent=2))

if __name__ == "__main__":
    generate_json()